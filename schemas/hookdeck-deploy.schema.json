{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"title": "Hookdeck Deploy Manifest",
	"description": "Configuration for Hookdeck resources managed by hookdeck-deploy",
	"type": "object",
	"properties": {
		"$schema": {
			"type": "string",
			"description": "JSON schema reference"
		},
		"sources": {
			"type": "array",
			"description": "List of Hookdeck source configurations",
			"items": {
				"$ref": "#/definitions/source"
			}
		},
		"destinations": {
			"type": "array",
			"description": "List of Hookdeck destination configurations",
			"items": {
				"$ref": "#/definitions/destination"
			}
		},
		"connections": {
			"type": "array",
			"description": "List of Hookdeck connection configurations",
			"items": {
				"$ref": "#/definitions/connection"
			}
		},
		"transformations": {
			"type": "array",
			"description": "List of Hookdeck transformation configurations",
			"items": {
				"$ref": "#/definitions/transformation"
			}
		}
	},
	"additionalProperties": false,
	"definitions": {
		"source": {
			"type": "object",
			"description": "Hookdeck source configuration (API-aligned)",
			"properties": {
				"name": {
					"type": "string",
					"description": "Source name (must be unique within the project)"
				},
				"type": {
					"type": "string",
					"description": "Source verification type (e.g. HMAC, BasicAuth, APIKey, Shopify, Stripe, ...)"
				},
				"description": {
					"type": "string",
					"description": "Human-readable description"
				},
				"config": {
					"type": "object",
					"description": "Type-specific configuration. Shape depends on the source type. Values may use ${ENV_VAR} interpolation.",
					"additionalProperties": true
				},
				"env": {
					"type": "object",
					"description": "Per-environment overrides for this source",
					"additionalProperties": {
						"$ref": "#/definitions/sourceOverride"
					}
				}
			},
			"required": ["name"],
			"additionalProperties": false
		},
		"sourceOverride": {
			"type": "object",
			"description": "Per-environment overrides for a source",
			"properties": {
				"type": {
					"type": "string",
					"description": "Source verification type override"
				},
				"description": {
					"type": "string",
					"description": "Description override"
				},
				"config": {
					"type": "object",
					"description": "Type-specific configuration overrides. Values may use ${ENV_VAR} interpolation.",
					"additionalProperties": true
				}
			},
			"additionalProperties": false
		},
		"destination": {
			"type": "object",
			"description": "Hookdeck destination configuration (API-aligned)",
			"properties": {
				"name": {
					"type": "string",
					"description": "Destination name (must be unique within the project)"
				},
				"type": {
					"type": "string",
					"description": "Destination type (e.g. HTTP, CLI, ...)"
				},
				"description": {
					"type": "string",
					"description": "Human-readable description"
				},
				"url": {
					"type": "string",
					"description": "Destination URL (e.g. https://my-worker.example.com)"
				},
				"auth_type": {
					"type": "string",
					"description": "Authentication type (e.g. API_KEY, HOOKDECK_SIGNATURE, BASIC_AUTH)",
					"enum": ["API_KEY", "HOOKDECK_SIGNATURE", "BASIC_AUTH", "CUSTOM_SIGNATURE"]
				},
				"auth": {
					"type": "object",
					"description": "Authentication configuration. Shape depends on auth_type.",
					"additionalProperties": true
				},
				"config": {
					"type": "object",
					"description": "Type-specific configuration. Shape depends on the destination type. Values may use ${ENV_VAR} interpolation.",
					"additionalProperties": true
				},
				"rate_limit": {
					"type": "integer",
					"description": "Maximum delivery rate",
					"minimum": 0
				},
				"rate_limit_period": {
					"type": "string",
					"enum": ["second", "minute", "hour", "concurrent"],
					"description": "Rate limit time period"
				},
				"env": {
					"type": "object",
					"description": "Per-environment overrides for this destination",
					"additionalProperties": {
						"$ref": "#/definitions/destinationOverride"
					}
				}
			},
			"required": ["name"],
			"additionalProperties": false
		},
		"destinationOverride": {
			"type": "object",
			"description": "Per-environment overrides for a destination",
			"properties": {
				"url": {
					"type": "string",
					"description": "Destination URL override"
				},
				"type": {
					"type": "string",
					"description": "Destination type override"
				},
				"description": {
					"type": "string",
					"description": "Description override"
				},
				"auth_type": {
					"type": "string",
					"description": "Authentication type override",
					"enum": ["API_KEY", "HOOKDECK_SIGNATURE", "BASIC_AUTH", "CUSTOM_SIGNATURE"]
				},
				"auth": {
					"type": "object",
					"description": "Authentication configuration override. Shape depends on auth_type.",
					"additionalProperties": true
				},
				"config": {
					"type": "object",
					"description": "Type-specific configuration overrides. Values may use ${ENV_VAR} interpolation.",
					"additionalProperties": true
				},
				"rate_limit": {
					"type": "integer",
					"description": "Maximum delivery rate override",
					"minimum": 0
				},
				"rate_limit_period": {
					"type": "string",
					"enum": ["second", "minute", "hour", "concurrent"],
					"description": "Rate limit period override"
				}
			},
			"additionalProperties": false
		},
		"connection": {
			"type": "object",
			"description": "Hookdeck connection configuration (API-aligned)",
			"properties": {
				"name": {
					"type": "string",
					"description": "Connection name (must be unique within the project)"
				},
				"source": {
					"type": "string",
					"description": "Source name to connect from"
				},
				"destination": {
					"type": "string",
					"description": "Destination name to connect to"
				},
				"filter": {
					"type": "object",
					"description": "Shorthand: event filter (converted to a filter rule). Uses MongoDB-like query syntax.",
					"additionalProperties": true
				},
				"transformations": {
					"type": "array",
					"description": "Shorthand: transformation names (converted to transform rules).",
					"items": { "type": "string" }
				},
				"rules": {
					"type": "array",
					"description": "Array of rule objects (filter, transform, retry, delay, etc.). Each rule has a 'type' field and type-specific properties.",
					"items": {
						"type": "object",
						"properties": {
							"type": {
								"type": "string",
								"description": "Rule type (e.g. filter, transform, retry, delay)"
							}
						},
						"required": ["type"],
						"additionalProperties": true
					}
				}
			},
			"required": ["name", "source"],
			"additionalProperties": false
		},
		"transformation": {
			"type": "object",
			"description": "Hookdeck transformation configuration",
			"properties": {
				"name": {
					"type": "string",
					"description": "Transformation name (must be unique within the project)"
				},
				"description": {
					"type": "string",
					"description": "Human-readable description"
				},
				"code_file": {
					"type": "string",
					"description": "Path to the JavaScript transformation source file (relative to manifest)"
				},
				"env": {
					"type": "object",
					"description": "Environment variables available to the transformation at runtime. Values may use ${ENV_VAR} interpolation.",
					"additionalProperties": {
						"type": "string"
					}
				},
				"env_overrides": {
					"type": "object",
					"description": "Per-environment overrides for this transformation",
					"additionalProperties": {
						"$ref": "#/definitions/transformationOverride"
					}
				}
			},
			"required": ["name", "code_file"],
			"additionalProperties": false
		},
		"transformationOverride": {
			"type": "object",
			"description": "Per-environment overrides for a transformation",
			"properties": {
				"description": {
					"type": "string",
					"description": "Description override"
				},
				"code_file": {
					"type": "string",
					"description": "Code file path override"
				},
				"env": {
					"type": "object",
					"description": "Environment variable overrides. Values may use ${ENV_VAR} interpolation.",
					"additionalProperties": {
						"type": "string"
					}
				}
			},
			"additionalProperties": false
		}
	}
}
