version: 2
env:
  - GO111MODULE=on
before:
  hooks:
    - go mod download
project_name: hookdeck-deploy-cli
builds:
  - id: npm-darwin-amd64
    binary: hookdeck-deploy-cli
    main: ./main.go
    goos: [darwin]
    goarch: [amd64]
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w -X github.com/toppynl/hookdeck-deploy-cli/cmd.version={{.Version}}
    hooks:
      post:
        - mkdir -p binaries/darwin-amd64
        - cp "{{ .Path }}" binaries/darwin-amd64/hookdeck-deploy-cli
        - chmod +x binaries/darwin-amd64/hookdeck-deploy-cli

  - id: npm-darwin-arm64
    binary: hookdeck-deploy-cli
    main: ./main.go
    goos: [darwin]
    goarch: [arm64]
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w -X github.com/toppynl/hookdeck-deploy-cli/cmd.version={{.Version}}
    hooks:
      post:
        - mkdir -p binaries/darwin-arm64
        - cp "{{ .Path }}" binaries/darwin-arm64/hookdeck-deploy-cli
        - chmod +x binaries/darwin-arm64/hookdeck-deploy-cli

  - id: npm-linux-amd64
    binary: hookdeck-deploy-cli
    main: ./main.go
    goos: [linux]
    goarch: [amd64]
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w -X github.com/toppynl/hookdeck-deploy-cli/cmd.version={{.Version}}
    hooks:
      post:
        - mkdir -p binaries/linux-amd64
        - cp "{{ .Path }}" binaries/linux-amd64/hookdeck-deploy-cli
        - chmod +x binaries/linux-amd64/hookdeck-deploy-cli

  - id: npm-linux-arm64
    binary: hookdeck-deploy-cli
    main: ./main.go
    goos: [linux]
    goarch: [arm64]
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w -X github.com/toppynl/hookdeck-deploy-cli/cmd.version={{.Version}}
    hooks:
      post:
        - mkdir -p binaries/linux-arm64
        - cp "{{ .Path }}" binaries/linux-arm64/hookdeck-deploy-cli
        - chmod +x binaries/linux-arm64/hookdeck-deploy-cli

  - id: npm-windows-amd64
    binary: hookdeck-deploy-cli
    main: ./main.go
    goos: [windows]
    goarch: [amd64]
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w -X github.com/toppynl/hookdeck-deploy-cli/cmd.version={{.Version}}
    hooks:
      post:
        - mkdir -p binaries/win32-amd64
        - cp "{{ .Path }}" binaries/win32-amd64/hookdeck-deploy-cli.exe
